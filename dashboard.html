<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - مشروع التغذية العلاجية</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/main.css">
</head>

<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <nav id="sidebar"></nav>

        <!-- Page Content -->
        <div id="content">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg navbar-light" id="navbar"></nav>

            <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">نظرة عامة</h2>
                    
                </div>

                <!-- Stats Cards Row 1 -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">مجموع المستخدمين</h6>
                                        <h3 class="mb-0" id="totalUsersCount">0</h3>
                                    </div>
                                    <i class="fas fa-users fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">مجموع الأطباء</h6>
                                        <h3 class="mb-0" id="totalDoctorsCount">0</h3>
                                    </div>
                                    <i class="fas fa-user-md fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">مجموع النصائح</h6>
                                        <h3 class="mb-0" id="totalTipsCount">0</h3>
                                    </div>
                                    <i class="fas fa-lightbulb fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">فئات الوجبات</h6>
                                        <h3 class="mb-0" id="mealCategoriesCount">0</h3>
                                    </div>
                                    <i class="fas fa-utensils fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards Row 2 -->
                <div class="row mb-3">
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">المستخدمين الدافعين</h6>
                                        <h3 class="mb-0" id="payingUsersCount">0</h3>
                                    </div>
                                    <i class="fas fa-credit-card fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">الأطباء قيد الانتظار</h6>
                                        <h3 class="mb-0" id="pendingDoctorsCount">0</h3>
                                    </div>
                                    <i class="fas fa-user-clock fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">فئات النصائح</h6>
                                        <h3 class="mb-0" id="tipsCategoriesCount">0</h3>
                                    </div>
                                    <i class="fas fa-tags fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">مجموع الإعلانات</h6>
                                        <h3 class="mb-0" id="totalAdsCount">0</h3>
                                    </div>
                                    <i class="fas fa-ad fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards Row 3 -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">مجموع الوجبات</h6>
                                        <h3 class="mb-0" id="totalMealsCount">0</h3>
                                    </div>
                                    <i class="fas fa-hamburger fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">المستخدمين المشتركين</h6>
                                        <h3 class="mb-0" id="subscribedUsersCount">0</h3>
                                    </div>
                                    <i class="fas fa-user-check fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">مجموع المنتديات</h6>
                                        <h3 class="mb-0" id="totalForumsCount">0</h3>
                                    </div>
                                    <i class="fas fa-comments fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white h-100" style="background-color: #9d0176;">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="card-title mb-1">مجموع الرسائل</h6>
                                        <h3 class="mb-0" id="totalMessagesCount">0</h3>
                                    </div>
                                    <i class="fas fa-envelope fa-2x opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

           
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/layout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            Layout.init('dashboard');
            loadDashboardData();
        });

        async function loadDashboardData() {
            const periodFilter = document.getElementById('periodFilter');
            const period = periodFilter ? periodFilter.value : 'all';
            
            try {
                // 1. Fetch Stats from API
                const response = await ApiService.dashboard.stats(period);
                // API returns { stats: {...}, recent_consultations: [...], monthly_revenue: [...] }
                const stats = response.stats || response;

                // Update UI with stats
                document.getElementById('totalUsersCount').innerText = stats.users?.total || 0;
                document.getElementById('payingUsersCount').innerText = stats.users?.paying || 0;
                document.getElementById('subscribedUsersCount').innerText = stats.users?.subscribed || 0;

                document.getElementById('totalDoctorsCount').innerText = stats.doctors?.total || 0;
                document.getElementById('pendingDoctorsCount').innerText = stats.doctors?.pending || 0;

                document.getElementById('totalTipsCount').innerText = stats.content?.tips || 0;
                document.getElementById('tipsCategoriesCount').innerText = stats.system?.tips_categories || 0;
                
                document.getElementById('totalMealsCount').innerText = stats.content?.meals || 0;
                document.getElementById('mealCategoriesCount').innerText = stats.system?.meal_categories || 0;
                
                document.getElementById('totalAdsCount').innerText = stats.system?.ads || 0;
                
                document.getElementById('totalForumsCount').innerText = stats.content?.forums || 0;
                document.getElementById('totalMessagesCount').innerText = stats.engagement?.messages || 0;

                console.log('Dashboard stats loaded:', stats);

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function addReminder() {
            alert('خاصية إضافة تذكير ستكون متاحة قريباً');
        }
    </script>
</body>

</html>